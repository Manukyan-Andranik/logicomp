{% extends "base.html" %}
{% block title %}<span data-translate-key="page_register">Register</span>{% endblock %}

{% block extra_css %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
    body { overflow-x: hidden; overflow-y: auto; }
    main.auth-main { display: flex; align-items: center; justify-content: center; min-height: calc(100vh - var(--navbar-height)); padding: 2rem 0 !important; background: linear-gradient(rgba(18, 18, 18, 0.8), rgba(18, 18, 18, 0.9)), url('https://images.unsplash.com/photo-1587620962725-abab7fe55159?auto=format&fit=crop&w=1350&q=80'); background-size: cover; background-position: center; }
    .auth-card { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(15px) saturate(180%); border: 1px solid var(--border-color); border-radius: 1rem; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
    .auth-card .card-title { color: white; font-weight: 700; }
    .contest-title { color: var(--primary); font-weight: 500; font-size: 1.1rem; margin-top: -10px; margin-bottom: 2rem; display: block; }
    .form-control-modern { background: transparent !important; border: none !important; border-bottom: 2px solid var(--border-color) !important; border-radius: 0 !important; color: black !important; padding: .5rem 2.5rem .5rem 0 !important; box-shadow: none !important; transition: border-color 0.3s ease; }
    .form-control-modern::placeholder { color: var(--text-muted); opacity: 1; }
    .form-control-modern:focus { border-bottom-color: var(--primary) !important; }
    .form-control-modern.is-invalid { border-bottom-color: #dc3545 !important; }
    .invalid-feedback-custom { color: #dc3545; font-size: 0.875em; margin-top: 0.25rem; display: block; }
    .password-wrapper { position: relative; }
    .password-toggle { position: absolute; top: 50%; right: 5px; transform: translateY(-50%); color: var(--text-muted); cursor: pointer; transition: color 0.2s ease; }
    .password-toggle:hover { color: var(--primary); }
    .btn-auth { background: var(--primary); border: none; color: #000; font-weight: bold; padding: 12px 0; border-radius: 50px; transition: all 0.3s ease; }
    .btn-auth:hover { background: var(--primary-dark); color: #000; box-shadow: 0 0 15px var(--primary); }
    .extra-links span { color: var(--text-muted) !important; }
    .extra-links a { color: var(--primary); text-decoration: none; font-size: 0.9rem; }
    .extra-links a:hover { text-decoration: underline; }
</style>
{% endblock %}

{% block content %}
<div class="auth-main">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-7 col-lg-5 col-xl-4" data-aos="fade-up">
                <div class="card auth-card">
                    <div class="card-body p-4 p-md-5">
                        <div class="text-center mb-4"><i class="bi bi-person-plus-fill fs-1" style="color: var(--primary);"></i><h2 class="card-title mt-2" data-translate-key="register_title">Create an Account</h2>{% if contest %}<p class="contest-title"><span data-translate-key="register_for_contest">for</span> "{{ contest.title }}"</p>{% endif %}</div>
                        <form method="POST">
                            {{ form.hidden_tag() }}
                            <div class="mb-4">
                                {{ form.username.label(class="form-label", **{'data-translate-key': 'username_label'}) }}
                                {{ form.username(class="form-control form-control-modern" + (" is-invalid" if form.username.errors else "")) }}
                                {% for error in form.username.errors %}<div class="invalid-feedback-custom"><i class="bi bi-exclamation-triangle-fill me-1"></i>{{ error }}</div>{% endfor %}
                            </div>
                            <div class="mb-4">
                                {{ form.email.label(class="form-label", **{'data-translate-key': 'email_label'}) }}
                                {{ form.email(class="form-control form-control-modern" + (" is-invalid" if form.email.errors else "")) }}
                                {% for error in form.email.errors %}<div class="invalid-feedback-custom"><i class="bi bi-exclamation-triangle-fill me-1"></i>{{ error }}</div>{% endfor %}
                            </div>

                            <div class="d-grid mt-4">{{ form.submit(class="btn btn-auth") }}</div>
                            <hr style="background-color: var(--border-color);" class="my-4">
                            <div class="text-center extra-links"><span data-translate-key="have_account">Already have an account?</span><a href="{{ url_for('auth.login') }}" data-translate-key="sign_in">Sign In</a></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    AOS.init({ duration: 800, offset: 50, once: true });
    
    document.querySelectorAll('.password-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
            const passwordField = this.previousElementSibling;
            if(passwordField) {
                const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordField.setAttribute('type', type);
                this.classList.toggle('bi-eye-slash-fill');
                this.classList.toggle('bi-eye-fill');
            }
        });
    });

    const registerTranslations = {
        'en': { 'page_register': 'Register', 'register_title': 'Create an Account', 'register_for_contest': 'for contest', 'username_label': 'Username', 'email_label': 'Email Address', 'password_label': 'Password', 'confirm_password_label': 'Confirm Password', 'register_button_text': 'Create Account', 'have_account': 'Already have an account?', 'sign_in': 'Sign In', 'username_placeholder': 'e.g. johndoe', 'email_placeholder': 'e.g. john.doe@example.com', 'password_placeholder': 'Enter a strong password' },
        'hy': { 'page_register': 'Գրանցում', 'register_title': 'Ստեղծել Հաշիվ', 'register_for_contest': 'մրցույթի համար', 'username_label': 'Օգտանուն', 'email_label': 'Էլ․ հասցե', 'password_label': 'Գաղտնաբառ', 'confirm_password_label': 'Հաստատեք Գաղտնաբառը', 'register_button_text': 'Ստեղծել Հաշիվ', 'have_account': 'Արդեն ունե՞ք հաշիվ', 'sign_in': 'Մուտք', 'username_placeholder': 'օր.՝ poghosyan', 'email_placeholder': 'օր.՝ poghos@example.com', 'password_placeholder': 'Մուտքագրեք հուսալի գաղտնաբառ' },
        'ru': { 'page_register': 'Регистрация', 'register_title': 'Создать Аккаунт', 'register_for_contest': 'для конкурса', 'username_label': 'Имя пользователя', 'email_label': 'Адрес электронной почты', 'password_label': 'Пароль', 'confirm_password_label': 'Подтвердите Пароль', 'register_button_text': 'Создать Аккаунт', 'have_account': 'Уже есть аккаунт?', 'sign_in': 'Войти', 'username_placeholder': 'напр. ivanov', 'email_placeholder': 'напр. ivan.ivanov@example.com', 'password_placeholder': 'Введите надежный пароль' }
    };
    Object.keys(registerTranslations).forEach(lang => { Object.assign(window.translations[lang], registerTranslations[lang]); });
    
    const updatePageText = () => {
        const lang = localStorage.getItem('language') || 'en'; const langDict = window.translations[lang] || window.translations['en'];
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            if(el.type === 'submit') { if(langDict.register_button_text) el.value = langDict.register_button_text; }
            else if (langDict[key]) el.textContent = langDict[key];
        });
        const userInput = document.querySelector('input[name="username"]'), emailInput = document.querySelector('input[name="email"]'), passInput = document.querySelector('input[name="password"]'), confPassInput = document.querySelector('input[name="confirm_password"]');
        if(userInput) userInput.placeholder = langDict.username_placeholder || ' ';
        if(emailInput) emailInput.placeholder = langDict.email_placeholder || ' ';
        if(passInput) passInput.placeholder = langDict.password_placeholder || ' ';
        if(confPassInput) confPassInput.placeholder = langDict.password_placeholder || ' '; 
    };
    updatePageText(); window.addEventListener('languageChanged', updatePageText);
});
</script>
{% endblock %}