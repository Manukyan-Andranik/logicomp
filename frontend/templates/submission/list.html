{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    /* Default Styles - Apply for Desktop and larger screens (or as base for mobile-first) */
    /* These styles are intended to be consistent with your original style.css and desired desktop look */
    main { background-color: #121212; }
    
    /* Root variables (as provided by you, ensuring consistency) */
    :root {
        --primary: #FFC107; 
        --primary-dark: #FFA000;
        --dark: #121212; 
        --text-light: #e0e0e0;
        --text-muted: #888;
        --border-color: rgba(255, 255, 255, 0.1);
        
        /* These subtle badge colors will now be overridden by your style.css's main badge styles */
        --bs-success-bg-subtle: rgba(40, 167, 69, 0.15); 
        --bs-success-text-emphasis: #28a745; 
        --bs-danger-bg-subtle: rgba(220, 53, 69, 0.15);   
        --bs-danger-text-emphasis: #dc3545;     
        --bs-warning-bg-subtle: rgba(255, 193, 7, 0.15); 
        --bs-warning-text-emphasis: #FFC107;   
        --bs-secondary-bg-subtle: rgba(108, 117, 125, 0.15); 
        --bs-secondary-text-emphasis: #6c757d;  
    }

    .container.py-4 {
        padding-top: 2rem !important; 
        padding-bottom: 2rem !important; 
        /* Default Bootstrap container padding is active horizontally; no px override here */
    }

    .d-flex.justify-content-between.align-items-center.mb-4.pb-2.border-bottom {
        flex-direction: row; 
        align-items: center;
        margin-bottom: 1.5rem !important; 
        padding-bottom: 0.5rem !important; 
    }
    .d-flex.justify-content-between.align-items-center.mb-4.pb-2.border-bottom h1 {
        font-size: 1.75rem; 
        margin-bottom: 0;
        color: inherit; /* Allow color to be inherited (e.g., from base.html/body style) */
    }
    .d-flex.justify-content-between.align-items-center.mb-4.pb-2.border-bottom .btn {
        width: auto; 
        padding: 0.375rem 0.75rem; 
        font-size: 0.875rem; 
        text-align: unset; 
    }

    .card.shadow-sm.border-0 {
        border-radius: 0.25rem; 
        background-color: #1a1a1a; 
        border: 1px solid var(--border-color) !important; 
        color: var(--text-light); 
        box-shadow: 0 .125rem .25rem rgba(0,0,0,.075) !important; 
    }
    .card-body.p-0 { 
        padding: 0 !important;
    }

    .table-responsive {
        /* Handled by Bootstrap */
    }
    .table {
        margin-bottom: 0; 
        border-collapse: collapse; 
    }

    .table th, .table td {
        vertical-align: middle;
        padding: 0.75rem; 
        font-size: inherit; 
        white-space: normal; 
        border-top: 1px solid var(--border-color) !important; 
        color: var(--text-light); 
    }
    .table thead th {
        text-transform: uppercase;
        font-weight: 600;
        font-size: 0.875rem; 
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--border-color) !important;
        text-align: left; 
    }
    .table thead th:nth-child(5), .table thead th:nth-child(6), .table thead th:nth-child(8) { text-align: center; } 
    .table td:nth-child(5), .table td:nth-child(6), .table td:nth-child(8) { text-align: center; } 
    .table td:nth-child(1), .table td:nth-child(4), .table td:nth-child(7) { text-align: left; } 


    .table tbody tr {
        background-color: #1a1a1a; 
        transition: background-color 0.2s ease;
    }
    .table tbody tr:hover {
        background-color: #252525;
    }

    /* Badges - fs-6 is still here, but colors will be from style.css's bg-* classes */
    .badge.fs-6 {
        font-size: 0.8rem; 
        padding: 0.4em 0.7em; 
        min-width: unset; 
    }

    /* Actions Button (inside table) */
    .btn-sm.btn-outline-primary {
        padding: 0.375rem 0.75rem; 
        font-size: 0.875rem; 
        color: var(--primary); /* Keep text color from primary var */
        border-color: var(--border-color); 
        background-color: transparent;
        transition: all 0.2s ease-in-out;
    }
    .btn-sm.btn-outline-primary:hover {
        color: white; 
        background-color: var(--primary); 
        border-color: var(--primary);
    }

    /* Empty State (as provided by you) */
    .table tbody tr:only-child td[colspan="8"] { 
        font-size: 1rem;
        padding: 5rem !important; 
        color: var(--text-muted); 
    }
    .table tbody tr:only-child .fs-1 {
        font-size: 3rem !important;
        color: var(--text-muted); 
    }

    /* Pagination (as provided by you) */
    .pagination {
        margin-top: 1.5rem !important;
    }
    .pagination .page-link {
        padding: 0.375rem 0.75rem; 
        font-size: inherit; 
        color: var(--primary); 
        border: 1px solid var(--border-color); 
        background-color: #1a1a1a; 
        transition: all 0.2s ease-in-out;
    }
    .pagination .page-link:hover {
        color: white; 
        background-color: var(--primary); 
        border-color: var(--primary);
    }
    .pagination .page-item.active .page-link {
        background-color: var(--primary) !important;
        border-color: var(--primary) !important;
        color: #000 !important; 
    }
    .pagination .page-item.disabled .page-link {
        color: var(--text-muted);
        background-color: #1a1a1a; 
        border-color: var(--border-color);
    }

    /* ---------------- Mobile-Specific Styles (max-width: 767px) ---------------- */
    /* These styles override the default/desktop styles for screens 767px or narrower. */
    @media (max-width: 767px) {
        .container.py-4 {
            padding-top: 1.5rem !important; 
            padding-bottom: 1.5rem !important;
            padding-left: 0.8rem !important; 
            padding-right: 0.8rem !important; 
        }

        /* Page Header */
        .d-flex.justify-content-between.align-items-center.mb-4.pb-2.border-bottom {
            flex-direction: column; 
            align-items: flex-start !important; 
            margin-bottom: 1rem !important; 
            padding-bottom: 1rem !important; 
        }
        .d-flex.justify-content-between.align-items-center.mb-4.pb-2.border-bottom h1 {
            font-size: 1.6rem; 
            margin-bottom: 0.75rem; 
        }
        .d-flex.justify-content-between.align-items-center.mb-4.pb-2.border-bottom .btn {
            width: 100%; 
            padding: 0.6rem 1rem; 
            font-size: 0.95rem; 
            text-align: center; 
        }

        /* Card containing the table */
        .card.shadow-sm.border-0 {
            border-radius: 0.75rem; /* Softer border-radius for mobile cards */
        }

        /* Table */
        /* white-space: nowrap on .table ensures horizontal scroll on .table-responsive */
        .table th, .table td {
            padding: 0.6rem 0.4rem; 
            font-size: 0.85rem; 
        }
        .table thead th {
            font-size: 0.75rem; 
        }

        /* Specific Column Widths / Text Alignment for mobile */
        /* These ensure content fits well on narrow screens and some wrapping is allowed */
        .table th:nth-child(1), .table td:nth-child(1) { width: 8%; text-align: center; } /* #ID */
        .table th:nth-child(2), .table td:nth-child(2) { width: 28%; white-space: normal; word-wrap: break-word; text-align: left; } /* Problem */
        .table th:nth-child(3), .table td:nth-child(3) { width: 22%; white-space: normal; word-wrap: break-word; text-align: left; } /* Contest */
        .table th:nth-child(4), .table td:nth-child(4) { width: 10%; text-align: center; } /* Language */
        .table th:nth-child(5), .table td:nth-child(5) { width: 10%; text-align: center; } /* Status */
        .table th:nth-child(6), .table td:nth-child(6) { width: 7%; text-align: center; } /* Time */
        .table th:nth-child(7), .table td:nth-child(7) { width: 15%; white-space: normal; word-wrap: break-word; font-size: 0.7rem; text-align: center; } /* Submitted */
        .table th:nth-child(8), .table td:nth-child(8) { width: 10%; text-align: center; } /* Actions */
        

        /* Badges for Status */
        .badge.fs-6 {
            font-size: 0.7rem; 
            padding: 0.3em 0.5em; 
            min-width: 45px; 
        }

        /* Actions Button (inside table) */
        .btn-sm.btn-outline-primary {
            padding: 0.3rem 0.6rem; 
            font-size: 0.7rem; 
        }

        /* Empty State */
        .table tbody tr:only-child td[colspan="8"] {
            font-size: 0.85rem; 
            padding: 1.5rem !important; 
        }
        .table tbody tr:only-child .fs-1 {
            font-size: 1.8rem !important; 
        }

        /* Pagination */
        .pagination .page-link {
            padding: 0.5rem 0.8rem; 
            font-size: 0.85rem; 
        }
    }
</style>
{% endblock %}


{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4 pb-2 border-bottom">
        <h1 class="h3"><i class="bi bi-list-task me-2"></i>{{ title }}</h1>
        {% if contest %}
            <a href="{{ url_for('contest.contest_view', contest_id=contest.id) }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i> Back to Contest
            </a>
        {% endif %}
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table mb-0 align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">#ID</th>
                            <th scope="col">Problem</th>
                            <th scope="col">Contest</th>
                            <th scope="col">Language</th>
                            <th scope="col" class="text-center">Status</th>
                            <th scope="col" class="text-center">Time</th>
                            <th scope="col">Submitted</th>
                            <th scope="col" class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission in submissions.items %}
                        <tr>
                            <td class="fw-bold">{{ submission.id }}</td>
                            <td>{{ submission.problem.title }}</td>
                            <td>{{ submission.problem.contest.title }}</td>
                            <td>{{ submission.language }}</td>
                            <td class="text-center">
                                <span class="badge fs-6
                                    {% if submission.status == 'Accepted' %} bg-success
                                    {% elif submission.status in ['Wrong Answer', 'Runtime Error'] %} bg-danger
                                    {% elif submission.status == 'Compilation Error' %} bg-warning
                                    {% else %} bg-secondary {% endif %}">
                                    {{ submission.status }}
                                </span>
                            </td>
                            <td class="text-center">
                                {% if submission.execution_time is not none %}
                                    {{ "%.2f"|format(submission.execution_time) }}s
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ submission.timestamp.strftime('%b %d, %Y %H:%M') }}</td>
                            <td class="text-center">
                                <a href="{{ url_for('submission.view', submission_id=submission.id) }}" class="btn btn-sm btn-outline-primary" title="View Details">
                                    <i class="bi bi-eye-fill"></i> View
                                </a>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-center py-5 text-muted">
                                <i class="bi bi-cloud-slash fs-1"></i>
                                <p class="mb-0 mt-2">No submissions found.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {# Pagination #}
    <nav aria-label="Submissions pagination" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item {% if not submissions.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('submission.my_submissions', page=submissions.prev_num, contest_id=contest.id if contest else None) }}">Previous</a>
            </li>
            {% for page_num in submissions.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                {% if page_num %}
                    <li class="page-item {% if submissions.page == page_num %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('submission.my_submissions', page=page_num, contest_id=contest.id if contest else None) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">…</span></li>
                {% endif %}
            {% endfor %}
            <li class="page-item {% if not submissions.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('submission.my_submissions', page=submissions.next_num, contest_id=contest.id if contest else None) }}">Next</a>
            </li>
        </ul>
    </nav>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
{# No custom JavaScript is added for this page #}
{% endblock scripts %}